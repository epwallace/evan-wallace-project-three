<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>evan's fantastic digital lite-brite</title>

    <!-- stylesheets -->
    <link rel="stylesheet" href="./styles/style.css">

    <!-- font assets -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lobster&display=swap">

    <!-- favicon assets -->
    <link rel="apple-touch-icon" sizes="180x180" href="./assets/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="./assets/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./assets/favicon/favicon-16x16.png">
    <link rel="manifest" href="./assets/favicon/site.webmanifest">
</head>

<body>
    <header>
        <div class="wrapper">
            <h1 class="svgBackground">evan's fantastic digital lite-brite</h1>
        </div>
    </header>

    <main class="wrapper">
        <!-- container for game instructions, controls, and board -->
        <div class="gameContainer">

            <!-- area for controlling colors and light effects -->
            <section class="gameControls">

                <!-- colour selection panel -->
                <div class="controlPanel colorSelectionPanel svgBackground">
                    <p class="panelText">choose a color</p>
                    <ul>
                        <li class="colorChoice red active" id="red"></li>
                        <li class="colorChoice orange" id="orange"></li>
                        <li class="colorChoice yellow" id="yellow"></li>
                        <li class="colorChoice green" id="green"></li>
                        <li class="colorChoice blue" id="blue"></li>
                        <li class="colorChoice purple" id="purple"></li>
                        <li class="colorChoice pink" id="pink"></li>
                        <li class="colorChoice white" id="white"></li>
                    </ul>
                </div>
    
                <!-- lightswitch panel -->
                <div class="controlPanel lightswitchPanel svgBackground">
                    <label for="lightswitch" class="panelText">toggle lights</label>
                    <input type="checkbox" id="lightswitch" name="lightswitch">
                </div>

                <!-- instructions -->
                <div class="controlPanel instructions svgBackground">
                    <p>Click a circle below to place or remove a coloured dot.</p>
                    <p>When you're ready to light up your masterpiece, toggle the lightswitch!</p>
                </div>
            </section>

            <!-- gameplay area -->
            <div class="board">
                <!-- individual grid squares are dynamically populated here by jQuery -->
            </div>
        </div>
    </main>

    <footer class="svgBackground">
        <p class="panelText">
            Made by
            <a href="https://www.github.com/epwallace">Evan Wallace</a>
            @
            <a href="https://www.junocollege.com">Juno College</a>
            in 2020.
        </p>
    </footer>

    <script src='https://code.jquery.com/jquery-3.5.1.min.js'integrity='sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0='crossorigin='anonymous'></script>
    <script>
        // create namespace for lite-brite app
        const liteBrite = {};

        // display an appropriately-sized game board populated with clickable squares
        liteBrite.displayBoard = () => {
            const gameBoardWidth = $('.board').width();

            // resize game board's height to form a square
            $('.board').height(gameBoardWidth);

            // set the grid properties appropriately for the initial viewport
            const size = Math.floor(gameBoardWidth / 40);
            $('.board').css({
                'grid-template-columns': `repeat(${size}, 1fr`,
                'grid-template-rows': `repeat(${size}, 1fr`
            });

            // populate the grid with the grid square elements
            const cellCount = size * size;
            for (i = 0; i < cellCount; i++) {
                $('.board').append('<div class="square"></div>');
            }
        }

        // make the height of grid squares equal to the width
        // TODO: refactor to resizeBoard
        liteBrite.resizeSquares = () => {
            const newHeight = $(".square").width();
            $(".square").height(newHeight);
            const gameBoardWidth = $('.board').width();
            $('.board').css({'height': `${gameBoardWidth}px`});
        }

        // add or remove dot from the given square
        liteBrite.toggleDot = (square) => {
            // if a dot is present in the square, remove it 
            if (square.children().length > 0) {
                   square.empty();
                } else {
                    // construct new dot with the correct color applied
                    const currentColor = $('.colorChoice.active').attr('id');
                    const newDot = $('<div class="dot">').addClass(currentColor);

                    // if the lightswitch is on, make the new dot glow
                    if ($('#lightswitch').prop('checked')) { 
                        $(newDot).addClass('lightup');
                    }

                    // add the new dot to the DOM
                    square.append(newDot);
                }
            }
        
        // add or remove glow effect from dots depending on lightswitch state
        liteBrite.toggleLightswitch = () => {
            if ($('#lightswitch').prop('checked')) {
                $('.dot').addClass('lightup');
            } else {
                $('.dot').removeClass('lightup');
            }
        }

        // set the user's color selection
        liteBrite.setColor = (colorSelection) => {
                $('.colorChoice.active').removeClass('active');
                colorSelection.addClass('active');
        }

        liteBrite.init = function() {
            liteBrite.displayBoard();

            // listen for window being resized
            $(window).on('resize', liteBrite.resizeSquares);

            // listen for color selection tiles being clicked
            $('.colorChoice').on('click', function() {
                liteBrite.setColor($(this));
            })

            // listen for grid squares being clicked
            $('.square').on('click', function() {
                liteBrite.toggleDot($(this));
            });

            // listen for lightswitch being toggled
            $('#lightswitch').on('change', liteBrite.toggleLightswitch);
        }

        $(document).ready(function() {
            liteBrite.init();
        })
    </script>
    
</body>
</html>
