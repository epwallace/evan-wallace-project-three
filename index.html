<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>evan's fantastic digital lite-brite</title>

    <!-- stylesheets -->
    <link rel="stylesheet" href="./styles/style.css">

    <!-- font assets -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lobster&family=Press+Start+2P&display=swap">

    <!-- favicon assets -->
    <link rel="apple-touch-icon" sizes="180x180" href="./assets/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="./assets/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./assets/favicon/favicon-16x16.png">
    <link rel="manifest" href="./assets/favicon/site.webmanifest">
</head>

<body>
    <header>
        <div class="wrapper">
            <h1 class="svgBackground">evan's fantastic digital lite-brite</h1>
        </div>
    </header>

    <div class="wrapper">
        <div class="gameContainer">

            <!-- area for controlling colors and light effects -->
            <section class="gameControls">

                <!-- colour selection panel -->
                <div class="controlPanel colorSelectionPanel svgBackground">
                    <p class="panelText">choose a color</p>
                    <ul>
                        <li class="colorChoice red active" id="red"></li>
                        <li class="colorChoice orange" id="orange"></li>
                        <li class="colorChoice yellow" id="yellow"></li>
                        <li class="colorChoice green" id="green"></li>
                        <li class="colorChoice blue" id="blue"></li>
                        <li class="colorChoice purple" id="purple"></li>
                        <li class="colorChoice pink" id="pink"></li>
                        <li class="colorChoice white" id="white"></li>
                    </ul>
                </div>
    
                <!-- lightswitch panel -->
                <div class="controlPanel lightswitchPanel svgBackground">
                    <label for="lightswitch" class="panelText">toggle lights</label>
                    <input type="checkbox" id="lightswitch" name="lightswitch">
                </div>
            </section>

            <!-- gameplay area -->
            <div class="board">
                <!-- individual grid squares are dynamically populated here by jQuery -->
            </div>
    </div>

    <script src='https://code.jquery.com/jquery-3.5.1.min.js'integrity='sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0='crossorigin='anonymous'></script>
    <script>
        // TODO: namespacing

        // fill the game board with a clickable grid of the specified size
        const populateBoard = (columns, rows) => {
            $('.board').css({
                'grid-template-columns': `repeat(${columns}, 1fr`,
                'grid-template-rows': `repeat(${rows}, 1fr`
            })

            const cellCount = columns * rows;
            for (i = 0; i < cellCount; i++) {
                $('.board').append('<div class="square"></div>');
            }
        }

        // make the height of grid squares equal to the width
        const resizeSquares = () => {
            const newHeight = $(".square").width();
            $(".square").height(newHeight);
            const gameBoardWidth = $('.board').width();
            $('.board').css({'height': `${gameBoardWidth}px`});
        }

        $(document).ready(function() {
            /* TODO: instead of a (28,28) grid, use dimensions that suit the initial viewport */
            populateBoard(20, 20);

            // set game board's height equal to its width
            const gameBoardWidth = $('.board').width();
            $('.board').css({'height': `${gameBoardWidth}px`});

            // update square height on board resize
            $(window).on('resize', function() {
                resizeSquares();
            });

            // define variables to track the state of the app;
            let currentColor = 'red';

            $('#lightswitch').change(function() {
                if ($('#lightswitch').prop('checked')) {
                    $('.dot').addClass('lightup');
                } else {
                    $('.dot').removeClass('lightup');
                }
                console.log(`the lights are on: ${$('#lightswitch').prop('checked')}`);
            })

            // update currentColor when user selects a color
            $('.colorChoice').on('click', function() {
                $('.colorChoice.active').removeClass('active');
                $(this).addClass('active');
                currentColor = $(this).attr("id");
            })

            // add or remove a dot when user clicks on a square
            $('.square').on('click', function() {
                // if a dot is present, remove it 
                if ($(this).children().length > 0) {
                   $(this).html('');
                } else {
                    // construct new dot node
                    let newDot = $.parseHTML(`<div class="dot ${currentColor}"></div>`)[0];

                    // if the lightswitch is on, make the new dot glow
                    if ($('#lightswitch').prop('checked')) { 
                        $(newDot).addClass('lightup');
                    }

                    // add the new dot to the DOM
                    $(this).html(newDot);
                }
           })

           // BUG: when the lightswitch is toggled, new dots should appear with .lightup style applied

           // toggle glow effect when the lightswitch is pressed
           $('button').on('click', function() {
               $('.dot').toggleClass('lightup');
           })
        })
    </script>
    
</body>
</html>
